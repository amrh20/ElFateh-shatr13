<div class="product-details-page py-5" *ngIf="product">
  <div class="container-xxl">
    <nav class="product-breadcrumb" aria-label="breadcrumb">
      <ol class="breadcrumb justify-content-center justify-content-lg-start mb-4">
        <li class="breadcrumb-item"><a routerLink="/home">الرئيسية</a></li>
        <li class="breadcrumb-item"><a routerLink="/categories">الأصناف</a></li>
        <li class="breadcrumb-item" *ngIf="product?.category">
          <a [routerLink]="['/categories']">{{ product.category }}</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
      </ol>
    </nav>

    <div class="row g-4">
      <!-- Product gallery -->
      <div class="col-lg-6">
        <div class="product-gallery card border-0 shadow-sm mb-3">
          <div class="product-gallery__image position-relative">
            <img [src]="selectedImage" [alt]="product?.name" (click)="openLightbox(selectedImage)" class="img-fluid" />
            <button type="button" class="zoom-trigger btn btn-light btn-sm rounded-circle" (click)="openLightbox(selectedImage)">
              <i class="pi pi-search-plus"></i>
            </button>
            <span *ngIf="hasDiscount()" class="badge bg-danger product-badge">-{{ calculateDiscountPercentage() }}%</span>
          </div>
        </div>

        <div class="product-thumbs d-flex flex-wrap gap-2">
          <button
            type="button"
            class="thumb-item btn p-0"
            *ngFor="let image of product?.images; let i = index"
            [class.active]="selectedImage === image"
            (click)="selectedImage = image"
            (dblclick)="openLightbox(image)"
          >
            <img [src]="image" [alt]="product?.name + ' ' + (i + 1)" class="img-fluid" />
          </button>
        </div>
      </div>

      <!-- Product summary -->
      <div class="col-lg-6">
        <!-- Product Title & Brand -->
        <div class="product-header card border-0 shadow-sm mb-3">
          <div class="card-body">
            <div class="mb-3">
              <h1 class="product-title-main mb-2">{{ product?.name }}</h1>
              <div class="d-flex flex-wrap align-items-center gap-2">
                <span *ngIf="product?.brand" class="badge-brand">
                  <i class="pi pi-tag"></i>
                  <span>{{ product.brand }}</span>
                </span>
                <span *ngIf="product?.category" class="badge-category">{{ product.category }}</span>
              </div>
            </div>
            <p class="product-description-text mb-0">{{ product?.description }}</p>
          </div>
        </div>


        <div class="product-actions card border-0 shadow-sm mb-3">
          <div class="card-body">
            <!-- Quantity and Price Row -->
            <div class="quantity-price-row mb-4">
              <div class="quantity-section">
                <label class="form-label fw-semibold mb-2 d-flex align-items-center gap-2">
                  <i class="pi pi-box"></i>
                  <span>الكمية</span>
                </label>
                <div class="quantity-controls">
                  <button class="qty-btn" type="button" (click)="decreaseQuantity()" [disabled]="quantity <= 1">
                    <i class="pi pi-minus"></i>
                  </button>
                  <span class="qty-value">{{ quantity }}</span>
                  <button class="qty-btn" type="button" (click)="increaseQuantity()">
                    <i class="pi pi-plus"></i>
                  </button>
                </div>
              </div>

              <div class="price-section">
                <label class="form-label fw-semibold mb-2 d-flex align-items-center gap-2">
                  <i class="pi pi-money-bill"></i>
                  <span>الإجمالي</span>
                </label>
                <div class="total-price">
                  <span class="price-amount">{{ getCurrentPrice() * quantity }}</span>
                  <span class="price-currency">ج.م</span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons-grid">
              <button 
                class="btn-add-cart" 
                type="button" 
                (click)="addToCart()" 
                [disabled]="!product?.stock"
              >
                <div class="btn-content">
                  <i class="pi pi-shopping-cart"></i>
                  <span>{{ product?.stock ? 'أضف للسلة' : 'غير متوفر' }}</span>
                </div>
              </button>

              <button
                type="button"
                class="btn-wishlist"
                [class.active]="isInWishlist"
                (click)="toggleWishlist()"
              >
                <div class="btn-content">
                  <i class="pi pi-heart" [class.pi-heart-fill]="isInWishlist"></i>
                  <span>{{ isInWishlist ? 'في المفضلة' : 'أضف للمفضلة' }}</span>
                </div>
              </button>
            </div>
          </div>
        </div>

        <!-- <div *ngIf="product?.specifications" class="product-specs card border-0 shadow-sm">
          <div class="card-body">
            <h3 class="section-title d-flex align-items-center gap-2 mb-3">
              <i class="pi pi-list-check text-danger"></i>
              <span>المواصفات</span>
            </h3>
            <ul class="specs-list list-unstyled mb-0">
              <li *ngFor="let spec of getSpecifications()" class="d-flex justify-content-between align-items-center">
                <span class="spec-key">{{ spec.key }}</span>
                <span class="spec-value">{{ spec.value }}</span>
              </li>
            </ul>
          </div>
        </div> -->
      </div>
    </div>

    <div class="related-products mt-5" *ngIf="relatedProducts.length > 0">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center gap-2 mb-4">
            <i class="pi pi-star-fill text-danger fs-5"></i>
            <h2 class="section-heading mb-0">منتجات مشابهة قد تعجبك</h2>
          </div>
          <div class="row g-3">
            <div class="col-6 col-md-4 col-lg-3" *ngFor="let relatedProduct of relatedProducts">
              <app-product-card [product]="relatedProduct"></app-product-card>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!product" class="loading-state py-5">
  <div class="text-center">
    <div class="spinner-border text-danger mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-muted">جاري التحميل...</p>
  </div>
</div>

<div *ngIf="showLightbox" class="lightbox-modal" (click)="closeLightbox()">
  <div class="lightbox-dialog" (click)="$event.stopPropagation()">
    <button type="button" class="btn-close btn-close-white lightbox-close" (click)="closeLightbox()"></button>
    <img [src]="lightboxImage" [alt]="product?.name" class="img-fluid" />
    <div class="lightbox-caption mt-3 text-white text-center fw-semibold">{{ product?.name }}</div>
  </div>
</div>
